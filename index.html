<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Cards</title>
  <style>
    body { font-family: sans-serif; max-width:600px; margin:auto; padding:1rem; }
    #status { font-weight:bold; margin-bottom:1rem; }
    ul { list-style:none; padding:0; }
    li {
      display:flex; justify-content:space-between; align-items:center;
      padding:.5rem; border:1px solid #ccc; border-radius:4px; margin-bottom:.5rem;
    }
    li:hover { background:#f5f5f5; }
    .text-item { flex:1; cursor:pointer; }
    .btn { margin-left:.5rem; padding:.25rem .5rem; border:none; border-radius:3px; cursor:pointer; }
    .btn-edit { background:#28a745; color:white; }
    .btn-comment { background:#007bff; color:white; }
    .btn-edit:hover { background:#218838; }
    .btn-comment:hover { background:#0056b3; }
  </style>
</head>
<body>
  <h1>Painel de Cards</h1>
  <div id="status">Carregandoâ€¦</div>
  <ul id="lista"></ul>

  <script>
    // ðŸ‘‰ Aqui Ã© onde vocÃª coloca o URL do seu Web App (desenvolvimento ou exec)
    const WEB_APP = 'https://script.google.com/macros/s/AKfycbz8q0sNKNA7JO_8NZw9_DGduOJ1qIExzbkSPSvHcedX/dev';

    // 1) Ler todos os registros da planilha via GET ?action=getData
    async function loadData() {
      document.getElementById('status').textContent = 'Carregandoâ€¦';
      try {
        const res   = await fetch(`${WEB_APP}?action=getData`);
        const items = await res.json();
        render(items);
        document.getElementById('status').textContent =
          `Foram carregados ${items.length} registros.`;
      } catch(err) {
        document.getElementById('status').textContent =
          'Erro ao carregar: ' + err.message;
        console.error(err);
      }
    }

    // 2) Renderiza cada linha como um "card"
    function render(items) {
      const ul = document.getElementById('lista');
      ul.innerHTML = '';
      if (!items || items.length === 0) {
        ul.innerHTML = '<li>Nenhum registro</li>';
        return;
      }
      items.forEach(item => {
        const li = document.createElement('li');

        // Texto principal
        const txt = document.createElement('div');
        txt.className = 'text-item';
        txt.textContent = Object.entries(item)
          .filter(([k]) => !['_row','comments','commentCount'].includes(k))
          .map(([k,v]) => `${k}: ${v}`)
          .join(' â”‚ ');
        txt.onclick = () => editarI(item._row, item.I);

        // BotÃ£o "Editar I"
        const btnEdit = document.createElement('button');
        btnEdit.className = 'btn btn-edit';
        btnEdit.textContent = `I: ${item.I||''}`;
        btnEdit.onclick   = () => editarI(item._row, item.I);

        // BotÃ£o "ComentÃ¡rios"
        const btnC = document.createElement('button');
        btnC.className = 'btn btn-comment';
        btnC.textContent = `ComentÃ¡rios (${item.commentCount||0})`;
        btnC.onclick     = () => comentar(item._row, item.comments);

        li.append(txt, btnEdit, btnC);
        ul.appendChild(li);
      });
    }

    // 3) Chama o Web App para atualizar a coluna I
    async function editarI(row, current) {
      const novo = prompt('Valor para Coluna I:', current||'');
      if (novo === null) return;
      await fetch(WEB_APP, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          action: 'updateI',
          row:    row,
          value:  novo
        })
      });
      loadData();
    }

    // 4) Chama o Web App para adicionar um comentÃ¡rio
    async function comentar(row, previous) {
      const antigas = Array.isArray(previous) ? previous.join('\n') : '';
      const msg = antigas
        ? `ComentÃ¡rios anteriores:\n${antigas}\n\nNovo:`
        : 'Digite seu comentÃ¡rio:';
      const novo = prompt(msg);
      if (!novo) return;
      await fetch(WEB_APP, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          action: 'addComment',
          row:     row,
          comment: novo
        })
      });
      loadData();
    }

    window.onload = loadData;
  </script>
</body>
</html>
